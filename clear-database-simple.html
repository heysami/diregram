<!DOCTYPE html>
<html>
<head>
  <title>Clear Diregram Database</title>
</head>
<body>
  <h1>Clear Diregram Database</h1>
  <p>Click the button below to clear the database. This will reset all nodes.</p>
  <button onclick="clearDatabase()" style="padding: 10px 20px; font-size: 16px; background: red; color: white; border: none; border-radius: 5px; cursor: pointer;">
    Clear Database
  </button>
  <div id="status" style="margin-top: 20px;"></div>

  <script type="module">
    import * as Y from 'https://cdn.jsdelivr.net/npm/yjs@13.6.10/+esm';
    import { HocuspocusProvider } from 'https://cdn.jsdelivr.net/npm/@hocuspocus/provider@2.8.0/+esm';

    window.clearDatabase = async function() {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = 'Connecting...';
      
      try {
        const doc = new Y.Doc();
        const wsUrl = 'ws://localhost:1234';
        const provider = new HocuspocusProvider({
          url: wsUrl,
          name: 'nexus-demo',
          document: doc,
        });

        await new Promise((resolve) => {
          provider.on('status', (data) => {
            if (data.status === 'connected') {
              resolve();
            }
          });
        });

        statusDiv.textContent = 'Connected. Clearing document...';
        
        // Clear the document by setting it to empty
        const yText = doc.getText('nexus');
        doc.transact(() => {
          yText.delete(0, yText.length);
          yText.insert(0, 'Root Node');
        });

        // Wait a bit for the change to sync
        await new Promise(resolve => setTimeout(resolve, 500));
        
        provider.destroy();
        doc.destroy();
        
        statusDiv.textContent = 'Database cleared successfully!';
        statusDiv.style.color = 'green';
      } catch (error) {
        statusDiv.textContent = 'Error: ' + error.message;
        statusDiv.style.color = 'red';
        console.error(error);
      }
    };
  </script>
</body>
</html>
